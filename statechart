<!DOCTYPE html>
<html lang="en">
<head>
    <!-- uses DavidDurman/statechart https://github.com/DavidDurman/statechart -->
    <meta charset="UTF-8">
    <title>Title</title>
    <!-- https://github.com/DavidDurman/statechart/blob/master/lib/statechart.js -->
    <script src = "statechart.js"></script>
    <!-- http://underscorejs.org/underscore-min.js -->
    <script src = "underscore.js"></script>
</head>
<body>
<div id = "currentState"></div>

<button onclick="gotoS1()">Go to S1</button>
<button onclick="gotoS2()">Go to S2</button>
<button onclick="gotoS3()">Go to S3</button>
<script>
    var lightSwitch = _.extend({

        // slots
        switch1: false,

        initialState: "S1",
        states: {
            'S1': {
                'entry': function () {
                    document.getElementById("currentState").innerHTML = 'S1';
                },
                'gotoS2':  { target: 'S2'   },
                'gotoS3': { target: 'S3'  }
            },
            'S2': {
                'entry': function () {
                    document.getElementById("currentState").innerHTML = 'S2';
                },
                'gotoS1':  { target: 'S1'  },
                'gotoS2': { target: 'S2' }
            },
            'S3': {
                init: 'S31',
                'entry': function () {
                    document.getElementById("currentState").innerHTML = 'S3';
                },
                states: {
                    'S31': {
                        'entry': function () {
                            document.getElementById("currentState").innerHTML = 'S31';
                        },
                        'gotoS1': {
                                guard: function() { return this.switch1 === false; },
                                action: function() { console.log('Hooray, transition takes place.')},
                                target: 'S1'
                             },
                        'gotoS2': {target: 'S2'}
                    },
                    'S32': {
                        'entry': function () {
                            document.getElementById("currentState").innerHTML = 'S32';
                        },
                        'gotoS1': {target: 'S1'},
                        'gotoS2': {target: 'S2'}
                    }
                }
            }
        }

    }, Statechart);


    // Initialize the state machine and make the initial transition
    lightSwitch.run();

    function gotoS1(){
        lightSwitch.dispatch('gotoS1');
    }

    function gotoS2(){
        lightSwitch.dispatch('gotoS2');
    }

    function gotoS3(){
        lightSwitch.dispatch('gotoS3');
    }

</script>

</body>
</html>
